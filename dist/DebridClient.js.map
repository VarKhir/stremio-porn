{"version":3,"sources":["../src/DebridClient.js"],"names":["DebridClient","constructor","httpClient","options","realDebridToken","torboxToken","torboxEndpoint","isEnabled","Boolean","_encodeForm","params","Object","keys","filter","key","map","encodeURIComponent","join","_pickUrl","body","download","link","location","data","_unrestrictWithRealDebrid","url","request","method","headers","Authorization","json","err","_unrestrictWithTorbox","_unrestrict","directUrl","unrestrictStreams","streams","Array","isArray","results","stream","push","unrestrictedUrl","name"],"mappings":"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","sourcesContent":["class DebridClient {\n  constructor(httpClient, options = {}) {\n    this.httpClient = httpClient\n    this.realDebridToken = options.realDebridToken\n    this.torboxToken = options.torboxToken\n    this.torboxEndpoint = options.torboxEndpoint ||\n      'https://api.torbox.app/v1/links/instant'\n  }\n\n  get isEnabled() {\n    return Boolean(this.realDebridToken || this.torboxToken)\n  }\n\n  _encodeForm(params = {}) {\n    return Object.keys(params)\n      .filter((key) => params[key])\n      .map((key) => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)\n      .join('&')\n  }\n\n  _pickUrl(body) {\n    if (!body || typeof body !== 'object') {\n      return null\n    }\n\n    if (typeof body.download === 'string') {\n      return body.download\n    }\n\n    if (typeof body.link === 'string') {\n      return body.link\n    }\n\n    if (typeof body.location === 'string') {\n      return body.location\n    }\n\n    if (body.data && typeof body.data === 'object') {\n      return this._pickUrl(body.data)\n    }\n\n    return null\n  }\n\n  async _unrestrictWithRealDebrid(url) {\n    if (!this.realDebridToken) {\n      return null\n    }\n\n    try {\n      let { body } = await this.httpClient.request(\n        'https://api.real-debrid.com/rest/1.0/unrestrict/link',\n        {\n          method: 'POST',\n          headers: {\n            Authorization: `Bearer ${this.realDebridToken}`,\n            'Content-Type': 'application/x-www-form-urlencoded',\n          },\n          body: this._encodeForm({ link: url }),\n          json: true,\n        }\n      )\n      return this._pickUrl(body)\n    } catch (err) {\n      return null\n    }\n  }\n\n  async _unrestrictWithTorbox(url) {\n    if (!this.torboxToken) {\n      return null\n    }\n\n    try {\n      let { body } = await this.httpClient.request(this.torboxEndpoint, {\n        method: 'POST',\n        headers: {\n          Authorization: `Bearer ${this.torboxToken}`,\n          'Content-Type': 'application/x-www-form-urlencoded',\n        },\n        body: this._encodeForm({ url }),\n        json: true,\n      })\n      return this._pickUrl(body)\n    } catch (err) {\n      return null\n    }\n  }\n\n  async _unrestrict(url) {\n    if (!url || !this.isEnabled) {\n      return null\n    }\n\n    let directUrl = await this._unrestrictWithRealDebrid(url)\n\n    if (directUrl) {\n      return directUrl\n    }\n\n    return this._unrestrictWithTorbox(url)\n  }\n\n  async unrestrictStreams(streams) {\n    if (!Array.isArray(streams) || !this.isEnabled) {\n      return streams || []\n    }\n\n    let results = []\n\n    for (let stream of streams) {\n      if (!stream || !stream.url) {\n        results.push(stream)\n        continue\n      }\n\n      let unrestrictedUrl = await this._unrestrict(stream.url)\n\n      if (unrestrictedUrl && unrestrictedUrl !== stream.url) {\n        results.push({\n          ...stream,\n          url: unrestrictedUrl,\n          name: stream.name || 'Debrid',\n        })\n      } else {\n        results.push(stream)\n      }\n    }\n\n    return results\n  }\n}\n\n\nexport default DebridClient\n"],"file":"DebridClient.js"}