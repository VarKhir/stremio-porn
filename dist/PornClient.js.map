{"version":3,"sources":["../src/PornClient.js"],"names":["ID","SORT_PROP_PREFIX","CACHE_PREFIX","MAX_ADAPTERS_PER_REQUEST","BASE_ADAPTERS","PornHub","RedTube","YouPorn","SpankWire","PornCom","Chaturbate","isUsenetAdapter","adapter","includeClass","UsenetStreamer","buildSorts","adapters","map","name","DISPLAY_NAME","SUPPORTED_TYPES","prop","types","buildCatalogs","reduce","catalogs","Adapter","forEach","type","push","id","toLowerCase","extra","isRequired","options","extraSupported","METHODS","adapterMethod","cacheTtl","idProp","expectsArray","makePornId","parsePornId","pornId","split","pop","normalizeRequest","request","query","sort","limit","skip","Object","keys","filter","p","startsWith","slice","length","search","porn_id","Error","includes","normalizeResult","item","newItem","constructor","mergeResults","results","adapterResults","PornClient","getAdapters","usenetStreamerUrl","getSorts","getCatalogs","getIdPrefixes","prefixes","some","ID_PREFIXES","httpClient","HttpClient","debridClient","DebridClient","realDebridToken","torboxToken","torboxEndpoint","adapterClasses","adapterOptions","baseUrl","sorts","cache","cacheManager","caching","store","redisStore","url","_getAdaptersForRequest","matchingAdapters","usenetAdapter","find","supportsId","_invokeAdapterMethod","method","unrestrictStreams","result","_invokeMethod","rawRequest","invokeMethod","methodName","cacheKey","JSON","stringify","cacheOptions","ttl","wrap"],"mappings":"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","sourcesContent":["import cacheManager from 'cache-manager'\nimport redisStore from 'cache-manager-redis-store'\nimport HttpClient from './HttpClient'\nimport DebridClient from './DebridClient'\nimport PornHub from './adapters/PornHub'\nimport RedTube from './adapters/RedTube'\nimport YouPorn from './adapters/YouPorn'\nimport SpankWire from './adapters/SpankWire'\nimport PornCom from './adapters/PornCom'\nimport Chaturbate from './adapters/Chaturbate'\nimport UsenetStreamer from './adapters/UsenetStreamer'\n\n// EPorner has restricted video downloads to 30 per day per guest\n// import EPorner from './adapters/EPorner'\n\n\nconst ID = 'porn_id'\nconst SORT_PROP_PREFIX = 'popularities.porn.'\nconst CACHE_PREFIX = 'stremio-porn|'\n// Making multiple requests to multiple adapters for different types\n// and then aggregating them is a lot of work,\n// so we only support 1 adapter per request for now.\nconst MAX_ADAPTERS_PER_REQUEST = 1\nconst BASE_ADAPTERS = [PornHub, RedTube, YouPorn, SpankWire, PornCom, Chaturbate]\nconst isUsenetAdapter = (adapter, includeClass = false) => {\n  return adapter instanceof UsenetStreamer ||\n    (includeClass && adapter === UsenetStreamer)\n}\nfunction buildSorts(adapters) {\n  return adapters.map(({ name, DISPLAY_NAME, SUPPORTED_TYPES }) => ({\n    name: `Porn: ${DISPLAY_NAME}`,\n    prop: `${SORT_PROP_PREFIX}${name}`,\n    types: SUPPORTED_TYPES,\n  }))\n}\n\nfunction buildCatalogs(adapters) {\n  return adapters.reduce((catalogs, Adapter) => {\n    if (isUsenetAdapter(Adapter, true)) {\n      return catalogs\n    }\n\n    Adapter.SUPPORTED_TYPES.forEach((type) => {\n      catalogs.push({\n        type,\n        id: `${Adapter.name.toLowerCase()}-${type}`,\n        name: Adapter.DISPLAY_NAME,\n        extra: [{\n          name: 'search',\n        }, {\n          name: 'skip',\n        }, {\n          name: 'genre',\n          isRequired: false,\n        }, {\n          name: 'sort',\n          options: [`${SORT_PROP_PREFIX}${Adapter.name}`],\n        }],\n        extraSupported: ['search', 'skip', 'genre', 'sort'],\n      })\n    })\n\n    return catalogs\n  }, [])\n}\nconst METHODS = {\n  'stream.find': {\n    adapterMethod: 'getStreams',\n    cacheTtl: 300,\n    idProp: ID,\n    expectsArray: true,\n  },\n  'meta.find': {\n    adapterMethod: 'find',\n    cacheTtl: 300,\n    idProp: 'id',\n    expectsArray: true,\n  },\n  'meta.search': {\n    adapterMethod: 'find',\n    cacheTtl: 3600,\n    idProp: 'id',\n    expectsArray: true,\n  },\n  'meta.get': {\n    adapterMethod: 'getItem',\n    cacheTtl: 300,\n    idProp: 'id',\n    expectsArray: false,\n  },\n}\n\n\nfunction makePornId(adapter, type, id) {\n  return `${ID}:${adapter}-${type}-${id}`\n}\n\nfunction parsePornId(pornId) {\n  let [adapter, type, id] = pornId.split(':').pop().split('-')\n  return { adapter, type, id }\n}\n\nfunction normalizeRequest(request) {\n  let { query, sort, limit, skip } = request\n  let adapters = []\n\n  if (sort) {\n    adapters = Object.keys(sort)\n      .filter((p) => p.startsWith(SORT_PROP_PREFIX))\n      .map((p) => p.slice(SORT_PROP_PREFIX.length))\n  }\n\n  if (typeof query === 'string') {\n    query = { search: query }\n  } else if (query) {\n    query = { ...query }\n  } else {\n    query = {}\n  }\n\n  if (query.porn_id) {\n    let { adapter, type, id } = parsePornId(query.porn_id)\n\n    if (type && query.type && type !== query.type) {\n      throw new Error(\n        `Request query and porn_id types do not match (${type}, ${query.type})`\n      )\n    }\n\n    if (adapters.length && !adapters.includes(adapter)) {\n      throw new Error(\n        `Request sort and porn_id adapters do not match (${adapter})`\n      )\n    }\n\n    adapters = [adapter]\n    query.type = type\n    query.id = id\n  }\n\n  return { query, adapters, skip, limit }\n}\n\nfunction normalizeResult(adapter, item, idProp = 'id') {\n  let newItem = { ...item }\n  newItem[idProp] = makePornId(adapter.constructor.name, item.type, item.id)\n  return newItem\n}\n\nfunction mergeResults(results) {\n  // TODO: limit\n  return results.reduce((results, adapterResults) => {\n    results.push(...adapterResults)\n    return results\n  }, [])\n}\n\n\nclass PornClient {\n  static ID = ID\n  static getAdapters(options = {}) {\n    let adapters = [...BASE_ADAPTERS]\n\n    if (options.usenetStreamerUrl) {\n      adapters.push(UsenetStreamer)\n    }\n\n    return adapters\n  }\n\n  static getSorts(options = {}, adapters = this.getAdapters(options)) {\n    return buildSorts(adapters)\n  }\n\n  static getCatalogs(options = {}, adapters = this.getAdapters(options)) {\n    return buildCatalogs(adapters)\n  }\n\n  static getIdPrefixes(options = {}, adapters = this.getAdapters(options)) {\n    let prefixes = []\n\n    if (options.usenetStreamerUrl && adapters.some((adapter) => isUsenetAdapter(adapter, true))) {\n      prefixes.push(...UsenetStreamer.ID_PREFIXES)\n    }\n\n    return prefixes\n  }\n\n  constructor(options) {\n    let httpClient = new HttpClient(options)\n    this.debridClient = new DebridClient(httpClient, {\n      realDebridToken: options.realDebridToken,\n      torboxToken: options.torboxToken,\n      torboxEndpoint: options.torboxEndpoint,\n    })\n    this.adapterClasses = PornClient.getAdapters(options)\n    this.adapters = this.adapterClasses.map((Adapter) => {\n      let adapterOptions = {}\n\n      if (Adapter === UsenetStreamer) {\n        adapterOptions = { baseUrl: options.usenetStreamerUrl }\n      }\n\n      return new Adapter(httpClient, adapterOptions)\n    })\n    this.sorts = buildSorts(this.adapterClasses)\n    this.catalogs = buildCatalogs(this.adapterClasses)\n\n    if (options.cache === '1') {\n      this.cache = cacheManager.caching({ store: 'memory' })\n    } else if (options.cache && options.cache !== '0') {\n      this.cache = cacheManager.caching({\n        store: redisStore,\n        url: options.cache,\n      })\n    }\n  }\n\n  _getAdaptersForRequest(request, adapterMethod) {\n    let { query, adapters } = request\n    let { type } = query\n    let matchingAdapters = this.adapters\n\n    if (adapters.length) {\n      matchingAdapters = matchingAdapters.filter((adapter) => {\n        return adapters.includes(adapter.constructor.name)\n      })\n    }\n\n    if (type) {\n      matchingAdapters = matchingAdapters.filter((adapter) => {\n        return adapter.constructor.SUPPORTED_TYPES.includes(type)\n      })\n    }\n\n    if (adapterMethod === 'getStreams') {\n      let usenetAdapter = (query.id && matchingAdapters.find((adapter) => {\n        return isUsenetAdapter(adapter) && adapter.supportsId(query.id)\n      })) || null\n\n      matchingAdapters = usenetAdapter ?\n        [usenetAdapter] :\n        matchingAdapters.filter((adapter) => !isUsenetAdapter(adapter))\n    } else {\n      matchingAdapters = matchingAdapters.filter((adapter) => !isUsenetAdapter(adapter))\n    }\n\n    return matchingAdapters.slice(0, MAX_ADAPTERS_PER_REQUEST)\n  }\n\n  async _invokeAdapterMethod(adapter, method, request, idProp) {\n    let results = await adapter[method](request)\n    if (method === 'getStreams') {\n      results = await this.debridClient.unrestrictStreams(results)\n    }\n    return results.map((result) => {\n      return normalizeResult(adapter, result, idProp)\n    })\n  }\n\n  // Aggregate method that dispatches requests to matching adapters\n  async _invokeMethod(adapterMethod, rawRequest, idProp) {\n    let request = normalizeRequest(rawRequest)\n    let adapters = this._getAdaptersForRequest(request, adapterMethod)\n\n    if (!adapters.length) {\n      throw new Error('Couldn\\'t find suitable adapters for a request')\n    }\n\n    let results = []\n\n    for (let adapter of adapters) {\n      let adapterResults = await this._invokeAdapterMethod(\n        adapter, adapterMethod, request, idProp\n      )\n      results.push(adapterResults)\n    }\n\n    return mergeResults(results, request.limit)\n  }\n\n  // This is a public wrapper around the private method\n  // that implements caching and result normalization\n  async invokeMethod(methodName, rawRequest) {\n    let { adapterMethod, cacheTtl, idProp, expectsArray } = METHODS[methodName]\n    let invokeMethod = async () => {\n      let result = await this._invokeMethod(adapterMethod, rawRequest, idProp)\n      result = expectsArray ? result : result[0]\n      return result\n    }\n\n    if (this.cache) {\n      let cacheKey = CACHE_PREFIX + JSON.stringify(rawRequest)\n      let cacheOptions = {\n        ttl: cacheTtl,\n      }\n      return this.cache.wrap(cacheKey, invokeMethod, cacheOptions)\n    } else {\n      return invokeMethod()\n    }\n  }\n}\n\n\nexport default PornClient\n"],"file":"PornClient.js"}