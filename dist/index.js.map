{"version":3,"sources":["../src/index.js"],"names":["SUPPORTED_METHODS","STATIC_DIR","DEFAULT_ID","ID","process","env","STREMIO_PORN_ID","ENDPOINT","STREMIO_PORN_ENDPOINT","PORT","STREMIO_PORN_PORT","PROXY","STREMIO_PORN_PROXY","HTTPS_PROXY","CACHE","STREMIO_PORN_CACHE","REDIS_URL","EMAIL","STREMIO_PORN_EMAIL","USENET_STREAMER","STREMIO_PORN_USENET_STREAMER","REAL_DEBRID_TOKEN","STREMIO_PORN_REAL_DEBRID_TOKEN","TORBOX_TOKEN","STREMIO_PORN_TORBOX_TOKEN","IS_PROD","NODE_ENV","console","error","chalk","red","exit","clientOptions","proxy","cache","usenetStreamerUrl","realDebridToken","torboxToken","adapters","PornClient","getAdapters","availableSites","map","a","DISPLAY_NAME","join","MANIFEST","name","id","version","pkg","description","types","idProperty","dontAnnounce","sorts","getSorts","catalogs","getCatalogs","resources","idPrefixes","getIdPrefixes","email","contactEmail","endpoint","logo","icon","background","filter","$exists","$in","makeMethod","client","methodName","request","cb","response","invokeMethod","err","gray","Date","toLocaleString","makeMethods","methodNames","reduce","methods","addon","Stremio","Server","server","http","createServer","req","res","url","status","manifest","config","writeHead","end","JSON","stringify","middleware","on","values","green","log","listen"],"mappings":"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","sourcesContent":["import http from 'http'\nimport Stremio from 'stremio-addons'\nimport serveStatic from 'serve-static'\nimport chalk from 'chalk'\nimport pkg from '../package.json'\nimport PornClient from './PornClient'\n\n\nconst SUPPORTED_METHODS = [\n  'stream.find', 'meta.find', 'meta.search', 'meta.get',\n]\nconst STATIC_DIR = 'static'\nconst DEFAULT_ID = 'stremio_porn'\n\nconst ID = process.env.STREMIO_PORN_ID || DEFAULT_ID\nconst ENDPOINT = process.env.STREMIO_PORN_ENDPOINT || 'http://localhost'\nconst PORT = process.env.STREMIO_PORN_PORT || process.env.PORT || '80'\nconst PROXY = process.env.STREMIO_PORN_PROXY || process.env.HTTPS_PROXY\nconst CACHE = process.env.STREMIO_PORN_CACHE || process.env.REDIS_URL || '1'\nconst EMAIL = process.env.STREMIO_PORN_EMAIL || process.env.EMAIL\nconst USENET_STREAMER = process.env.STREMIO_PORN_USENET_STREAMER\nconst REAL_DEBRID_TOKEN = process.env.STREMIO_PORN_REAL_DEBRID_TOKEN\nconst TORBOX_TOKEN = process.env.STREMIO_PORN_TORBOX_TOKEN\nconst IS_PROD = process.env.NODE_ENV === 'production'\n\n\nif (IS_PROD && ID === DEFAULT_ID) {\n  // eslint-disable-next-line no-console\n  console.error(\n    chalk.red(\n      '\\nWhen running in production, a non-default addon identifier must be specified\\n'\n    )\n  )\n  process.exit(1)\n}\n\nlet clientOptions = {\n  proxy: PROXY,\n  cache: CACHE,\n  usenetStreamerUrl: USENET_STREAMER,\n  realDebridToken: REAL_DEBRID_TOKEN,\n  torboxToken: TORBOX_TOKEN,\n}\nlet adapters = PornClient.getAdapters(clientOptions)\nlet availableSites = adapters.map((a) => a.DISPLAY_NAME).join(', ')\n\nconst MANIFEST = {\n  name: 'Porn',\n  id: ID,\n  version: pkg.version,\n  description: `\\\nTime to unsheathe your sword! \\\nWatch porn videos and webcam streams from ${availableSites}\\\n`,\n  types: ['movie', 'tv'],\n  idProperty: PornClient.ID,\n  dontAnnounce: !IS_PROD,\n  sorts: PornClient.getSorts(clientOptions, adapters),\n  catalogs: PornClient.getCatalogs(clientOptions, adapters),\n  resources: ['stream', 'meta', 'catalog'],\n  // Stremio manifest allows advertising supported external id prefixes for stream requests\n  idPrefixes: PornClient.getIdPrefixes(clientOptions, adapters),\n  // The docs mention `contactEmail`, but the template uses `email`\n  email: EMAIL,\n  contactEmail: EMAIL,\n  endpoint: `${ENDPOINT}/stremioget/stremio/v1`,\n  logo: `${ENDPOINT}/logo.png`,\n  icon: `${ENDPOINT}/logo.png`,\n  background: `${ENDPOINT}/bg.jpg`,\n  // OBSOLETE: used in pre-4.0 stremio instead of idProperty/types\n  filter: {\n    [`query.${PornClient.ID}`]: { $exists: true },\n    'query.type': { $in: ['movie', 'tv'] },\n  },\n}\n\n\nfunction makeMethod(client, methodName) {\n  return async (request, cb) => {\n    let response\n    let error\n\n    try {\n      response = await client.invokeMethod(methodName, request)\n    } catch (err) {\n      error = err\n\n      /* eslint-disable no-console */\n      console.error(\n        // eslint-disable-next-line prefer-template\n        chalk.gray(new Date().toLocaleString()) +\n        ' An error has occurred while processing ' +\n        `the following request to ${methodName}:`\n      )\n      console.error(request)\n      console.error(err)\n      /* eslint-enable no-console */\n    }\n\n    cb(error, response)\n  }\n}\n\nfunction makeMethods(client, methodNames) {\n  return methodNames.reduce((methods, methodName) => {\n    methods[methodName] = makeMethod(client, methodName)\n    return methods\n  }, {})\n}\n\n\nlet client = new PornClient(clientOptions)\nlet methods = makeMethods(client, SUPPORTED_METHODS)\nlet addon = new Stremio.Server(methods, MANIFEST)\nlet server = http.createServer((req, res) => {\n  if (req.url === '/api/status') {\n    let status = {\n      manifest: {\n        name: MANIFEST.name,\n        version: MANIFEST.version,\n        description: MANIFEST.description,\n        catalogs: MANIFEST.catalogs,\n        dontAnnounce: MANIFEST.dontAnnounce,\n      },\n      config: {\n        cache: CACHE !== '0',\n        proxy: !!PROXY,\n      },\n    }\n    res.writeHead(200, { 'Content-Type': 'application/json' })\n    res.end(JSON.stringify(status))\n    return\n  }\n  serveStatic(STATIC_DIR)(req, res, () => {\n    addon.middleware(req, res, () => res.end())\n  })\n})\n\nserver\n  .on('listening', () => {\n    let values = {\n      endpoint: chalk.green(MANIFEST.endpoint),\n      id: ID === DEFAULT_ID ? chalk.red(ID) : chalk.green(ID),\n      email: EMAIL ? chalk.green(EMAIL) : chalk.red('undefined'),\n      env: IS_PROD ? chalk.green('production') : chalk.green('development'),\n      proxy: PROXY ? chalk.green(PROXY) : chalk.red('off'),\n      cache: (CACHE === '0') ?\n        chalk.red('off') :\n        chalk.green(CACHE === '1' ? 'on' : CACHE),\n    }\n\n    // eslint-disable-next-line no-console\n    console.log(`\n    ${MANIFEST.name} Addon is listening on port ${PORT}\n\n    Endpoint:    ${values.endpoint}\n    Addon Id:    ${values.id}\n    Email:       ${values.email}\n    Environment: ${values.env}\n    Proxy:       ${values.proxy}\n    Cache:       ${values.cache}\n    `)\n  })\n  .listen(PORT)\n\n\nexport default server\n"],"file":"index.js"}